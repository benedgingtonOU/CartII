<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name = "viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
<title>COVID Vaccination Rates in Ohio</title>
<style>
html, 
body{
width: 99.6%;
height: 99.2%;
background-color: black;
}
h2{
	text-align: ;
	color: white;
	float: right;
}
#leftDiv{
	padding:0;
	float: left;
	left: 0;
	margin:0;
	height:89%;
	width: 49.9%;
}
#rightDiv{
	float: right;
	right: 0;
	padding: 0;
	margin: 0;
	height: 89%;
	width: 49.9%;
}
#titleDiv{
	float: left;
	height: 27px;
	width: 49.5%;
	background-color: black;
	color: white;
	text-align: left;
	padding-right: 0.5%;
	font-weight: 400;
	font-size: 25px;
}
#header{
	width: 99.2%;
	background-color: #313131;
	height: 2%;
	text-align: center;
	color: white;
}
#extentDiv{
	border: 2px solid red;
	position: absolute;
	z-index: 2;
}
#paneDiv1{
	position: absolute;
	top: 13%;
	right: 50.5%;
	padding: 12px;
	background-color: rgba(0, 0, 0, 0.5);
	color: white;
}
#paneDiv2{
	position: absolute;
	top: 13%;
	right: .5%;
	padding: 12px;
	background-color: rgba(0, 0, 0, 0.5);
	color: white;
}
#overviewDiv {
	position: absolute;
	top: 13%;
	right: 38.8%;
	width: 200px;
	height: 150px;
	border: 1px solid black;
	z-index: 1;
}
</style>
<link rel="stylesheet" href="https://js.arcgis.com/4.21/esri/css/main.css">
<script src="https://js.arcgis.com/4.21/"></script>
<script>
require([
"esri/Map",
"esri/views/MapView",
"esri/layers/FeatureLayer",
"esri/widgets/Legend",
"esri/layers/CSVLayer",
"esri/layers/VectorTileLayer",
"esri/layers/support/LabelClass",
"esri/widgets/LayerList",
"esri/symbols/SimpleFillSymbol",
"esri/renderers/SimpleRenderer",
"esri/config",
"esri/core/watchUtils",
"esri/geometry/Point",
"dojo/dom",
"dojo/promise/all",
"dojo/domReady!"
], function(
Map,
MapView,
FeatureLayer,
Legend,
CSVLayer,
VectorTileLayer,
LabelClass,
LayerList,
SimpleFillSymbol,
SimpleRenderer,
esriConfig,
watchUtils,
Point,
dom,
all)
{
var map1 = new Map();
var view1 = new MapView({
	container: "leftDiv",
	map: map1,
	scale: 2000000,
	extent:{
			xmin: -101,
			ymin: 34,
			xmax: -133,
			ymax: 49,
			spatialReference: 4326
		},
	center: [-82.7, 40],
});
view1.goTo({
	scale: 2000000,
	center: [-82.7, 40.3]
});
var map2 = new Map();
var view2 = new MapView({
	container: "rightDiv",
	map: map2,
	scale: 2000000,
	center: [-82.7, 40.3],
	constraints:{
		rotationEnabled: false
	}
});
var myBasemap1 = new VectorTileLayer({
	url: "https://arts-sciences.maps.arcgis.com/sharing/rest/content/items/5d91515a776241e3873b5dda410a4a6e/resources/styles/root.json?f=pjson"
});
var myBasemap2 = new VectorTileLayer({
	url: "https://arts-sciences.maps.arcgis.com/sharing/rest/content/items/5d91515a776241e3873b5dda410a4a6e/resources/styles/root.json?f=pjson"
});
map1.add(myBasemap1);
map2.add(myBasemap2);

var vaxRate1 = new FeatureLayer({
		portalItem:{
			id:"c7b1de652c6f44dcb333a48600592e85"
		}
	});
map1.add(vaxRate1);

var vaxRate2 = new FeatureLayer({
		portalItem:{
			id:"7ecc73252dfa4845ad8473902547b60e"
		}
	});
map1.add(vaxRate2);

var popDensity = new FeatureLayer({
		portalItem:{
			id:"29d1f6bf7af6426e8b11cb29d7b36613"
		}
	});
map2.add(popDensity);

var medIncome = new FeatureLayer({
		portalItem:{
			id:"83b21ac3900c4d628e785c30ecbf48fd"
		}
	});
map2.add(medIncome);
popDensity.visible = false;
vaxRate2.visible = false; 

var leftLegend = new Legend({
		view: view1,
		hideLayersNotInCurrentView: false,
		respectLayerVisibility: false,
		layerInfos: [{
			layer: vaxRate1,
			title: "Vacciantion Rate"
		}]
	});
view1.ui.add(leftLegend, "bottom-right");

var rightLegend = new Legend({
		view: view2,
		hideLayersNotInCurrentView: true,
		layerInfos: [{
			layer: popDensity,
			title: "Population Density"
		},{
			layer: medIncome,
			title: "Median Household Income"
		}]
	});
view2.ui.add(rightLegend, "bottom-right");

var countyLabelSymbol = {
	type: "text",
	color: "white",
	haloColor: "black",
	haloSize: "1px",
	text: "You are here",
	xoffset: 0,
	yoffset: 0,
	font: {
		size: 10,
		family: "sans-serif",
		weight: "bold"
	}
};
const countyLabels = new LabelClass({
	labelExpressionInfo: {expression: "$feature.NAME"},
	symbol: countyLabelSymbol,
	labelPlacement: "above-along"
});
vaxRate1.labelingInfo = [countyLabels];
vaxRate2.labelingInfo = [countyLabels];
popDensity.labelingInfo = [countyLabels];
medIncome.labelingInfo = [countyLabels];
var synchronizeView = function(view1, others){
	others = Array.isArray(others)? others: [others];
	var viewpointWatchHandle;
	var viewStationaryHandle;
	var otherInteractHandlers;
	var scheduleId;
	var clear = function(){
		if(otherInteractHandlers){
			otherInteractHandlers.forEach(function(handle){
				handle.remove();
			});
		}
		viewpointWatchHandle && viewpointWatchHandle.remove();
		viewStationaryHandle && viewStationaryHandle.remove();
		scheduleId && clearTimeout(scheduleId);
		otherInteractHandlers = 
		viewpointWatchHandle = viewStationaryHandle = scheduleId = null;
	};
	var interactWatcher = 
	view1.watch('interacting, animation',function(newValue){
		if(!newValue){
			return;
		}
		if(viewpointWatchHandle || scheduleId){
			return;
		}
		scheduleId = setTimeout(function(){
			scheduleId=null;
			viewpointWatchHandle=view1.watch('viewpoint', function(newValue){
				others.forEach(function(otherView){
					otherView.viewpoint=newValue;
				});
			});
	},0);
	otherInteractHandlers = others.map(function(otherView){
		return watchUtils.watch(otherView,
		'interacting, animation',
		function(
			value){
				if(value){
					clear();
				}
			});
	});
viewStationaryHandle = watchUtils.whenTrue(view1, 'stationary', clear);
});
return {
remove: function() {
	this.remove = function() {};
	clear();
	interactWatcher.remove();
}
}
};
var synchronizeViews = function(views) {
	var handles =
	views.map(function(view1,idx,views){
		var others = views.concat();
		others.splice(idx,1);
		return synchronizeView(view1,others);
	});
	return {
	remove: function(){
		this.remove = function(){};
		handles.forEach(function(h){
			h.remove();
		});
		handles = null;
	}
}
}
synchronizeViews([view1,view2]);

document.getElementById("vaxToggle1").addEventListener("click", function() {
	vaxRate1.visible = true;
	vaxRate2.visible = false;
});
document.getElementById("vaxToggle2").addEventListener("click", function() {
	vaxRate1.visible = false;
	vaxRate2.visible = true;
});
document.getElementById("otherToggle1").addEventListener("click", function() {
	medIncome.visible = true;
	popDensity.visible = false;
});
document.getElementById("otherToggle2").addEventListener("click", function() {
	medIncome.visible = false;
	popDensity.visible = true;
});

var overviewmap = new Map({
	basemap: "dark-gray"
	});
var smallview = new MapView({
		container: "overviewDiv",
		map: overviewmap,
		constraints: {
			rotationEnabled: false
		}
	});
	smallview.ui.components = [];

	var ExtentDiv = 
	document.getElementById("extentDiv");

	smallview.when(function(){
		view1.watch("extent", updateOverviewExtent);
		smallview.watch("extent", updateOverviewExtent);

		watchUtils.when(view1, "stationary", updateoverview);
		function updateoverview(){
			smallview.goTo({
				center: view1.center,
				scale: view1.scale * 2 * Math.max
					(view1.width / smallview.width,
					view1.height / smallview.height)
			});
		}

function updateOverviewExtent() {  
    var extent = view1.extent;
   
    var bottomLeft = smallview.toScreen(new Point({
    x: extent.xmin,
    y: extent.ymin,
    spatialReference: extent.spatialReference})
    );
    var topRight = smallview.toScreen(new Point({
    x: extent.xmax,
    y: extent.ymax,
    spatialReference: extent.spatialReference})
    );
   
    ExtentDiv.style.top = topRight.y + "px";
    ExtentDiv.style.left = bottomLeft.x + "px";
   
    ExtentDiv.style.height = (bottomLeft.y - topRight.y) + "px";
    ExtentDiv.style.width = (topRight.x - bottomLeft.x) + "px";
   
    }
	});


});</script>
</head>
<body>
<div id= "header"; style="display: table; height: 2px; overflow: hidden;">
<h1 style="virtical-align: middle">Vaccination Rates compared to Income and Population Density in Ohio</h1></div>
<div id = "titleDiv"> Vaccination Rates</div>
<div id = "titleDiv"> Median Household Income and Population Density</div>
<div id="leftDiv"></div>
<div id="rightDiv"></div>
<div id = "overviewDiv">
<div id = "extentDiv"> </div>
</div> 
<div id="paneDiv1"> 
<div>
<input type="radio" name="vaxView" value="firstDose" checked="checked" id="vaxToggle1" />
<label for="vaxToggle1"> First Dose</label>
</div>
<div>
<input type="radio" name="vaxView" value="secondDose" id="vaxToggle2" />
<label for="vaxToggle2"> Second Dose</label>
</div>
</div>

<div id="paneDiv2">  
<div>
<input type="radio" name="otherView" value="income" checked="checked" id="otherToggle1" />
<label for="otherToggle1"> Median Household Income</label>
</div>
<div>
<input type="radio" name="otherView" value="density" id="otherToggle2" />
<label for="otherToggle2"> Population Density</label>
</div>
</div>
</body>
</html>
